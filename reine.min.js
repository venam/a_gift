function B1(a){return a*a*a}function B2(a){return 3*a*a*(1-a)}function B3(a){return 3*a*(1-a)*(1-a)}function B4(a){return(1-a)*(1-a)*(1-a)}function getBezier(a,b,c,d,e){var f={};f.x=b.x*B1(a)+c.x*B2(a)+d.x*B3(a)+e.x*B4(a);f.y=b.y*B1(a)+c.y*B2(a)+d.y*B3(a)+e.y*B4(a);return f}
function draw_scroll(){var a=d3.select("#scroll").append("svg").attr("width",320).attr("height",120),b=a.append("text").attr("transform","translate(160,20)").attr("y",6).attr("dy",".71em").style("font-size","35px").style("text-anchor","middle").text("Scroll Down");a.append("text").attr("transform","translate(160,0)").attr("dy",".71em").style("font-size","15px").style("text-anchor","middle").text("Slowly");window.scrollTo(0,0);setInterval(function(){b.transition().duration(500).style("font-size","35px").style("font-weight",
"normal").transition().duration(600).style("font-weight","bold").style("font-size","40px")},1300)}function dots_timer(){d3.timer(function(){if(200<window.scrollY)return draw_dots(),!0})}function draw_dots(){for(var a=d3.select("#dots").append("svg").attr("width",320).attr("height",400),b=40,c=300,d=30,e=0;4>e;e++)a.append("circle").attr("cy",b).attr("cx",160).attr("r",0).transition().delay(c).duration(500).attr("r",d),c+=c-100,b+=100,d-=7}
function once_upon_timer(){d3.timer(function(){if(550<window.scrollY)return draw_once_upon(),!0})}
function draw_once_upon(){for(var a=d3.select("#upon").append("svg").attr("width",320).attr("height",400),b=[],c={x:280,y:66},d={x:170,y:75},e={x:155,y:100},f={x:160,y:150},g=0;20>g;g++){var h=getBezier(g/20,c,d,e,f);b.push({x:h.x,y:h.y,w:4})}b=b.reverse();a.selectAll("circle").data(b).enter().append("circle").attr("cy",function(a){return a.y}).attr("cx",function(a){return a.x}).attr("r",0).transition().delay(function(a,b){return 40*b+1500}).duration(200).attr("r",function(a){return a.w}).transition().delay(function(a,
b){return 40*b+1900}).duration(1E3).style("opacity","0");b=a.append("text").attr("transform","translate(40,550)").attr("dy",".71em").style("font-size","50px").style("text-anchor","left").text("Once");c=a.append("text").attr("transform","translate(120,550)").attr("dy",".71em").style("font-size","50px").style("text-anchor","left").text("Upon");d=a.append("text").attr("transform","translate(200,550)").attr("dy",".71em").style("font-size","50px").style("text-anchor","left").text("a Time");b.transition().duration(1E3).delay(300).ease("cubic-out").attr("transform",
"translate(40,20)");c.transition().duration(1E3).delay(600).ease("cubic-out").attr("transform","translate(120,20)");d.transition().duration(1E3).delay(900).ease("cubic-out").attr("transform","translate(200,20)");a.transition().delay(3500).attr("height",160)}function there_was_timer(){d3.timer(function(){if(720<window.scrollY)return draw_there_was(),!0})}function letter_by_letter(a,b,c){for(var d=0;d<b.length;d++)draw_after_timeout(a,b[d],d*c)}
function draw_after_timeout(a,b,c){window.setTimeout(function(){a.text(a.text()+b)},c)}
function draw_there_was(){var a=d3.select("#there").append("svg").attr("width",320).attr("height",200),b=a.append("text").attr("transform","translate(160,20)").attr("dy",".71em").style("font-size","50px").style("text-anchor","middle").text("");d3.select("#upon svg").append("g").append("rect").attr("x",20).attr("y",150).attr("height","2").attr("width",0).transition().delay(1400).duration(800).attr("width",280);letter_by_letter(b,"There was a beautiful",45);var c=a.append("text").attr("transform","translate(160,70)").attr("dy",
".71em").style("font-size","50px").style("text-anchor","middle").text("");window.setTimeout(function(){letter_by_letter(c,"young lady named",45)},1300);a.append("g").append("rect").attr("x",280).attr("y",150).attr("height","2").attr("width",0).transition().delay(1600).duration(800).attr("x",20).attr("width",280)}function her_name_timer(){d3.timer(function(){if(860<window.scrollY)return write_her_name(),!0})}
function draw_path_slowly(a,b,c,d){b=a.append("g").append("path").style({fill:"none",stroke:"#ff6c5c","stroke-width":"2","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":"4"}).attr("d",b);a=b.node().getTotalLength();b.attr("stroke-dasharray",a+" "+a).attr("stroke-dashoffset",a).transition().delay(c).duration(d).ease("linear").attr("stroke-dashoffset",0)}
function write_her_name(){for(var a=d3.select("#her_beautiful_name").append("svg").attr("width",320).attr("height",180),b="m 40.911178,92.40855 c 38.181838,41.0943 19.953371,73.74391 -13.131983,71.72083 l 0,0.50508;M 28.789348,105.54053 C 25.976855,85.977894 69.495032,88.99721 84.690373,98.990929 133.25568,130.93151 66.650895,140.98966 56.063466,130.79435 l -0.505076,-0.50508;m 55.053314,131.29942 c 6.664582,-10.28452 26.595501,-7.33699 36.870568,-2.0203 8.745528,10.68919 -7.820779,21.62282 -3.752868,40.97594 1.516326,7.21394 17.920026,6.60559 26.481296,0.94539;m 123.74369,164.12938 12.12183,-9.59645 c -6.00006,-1.61053 -11.04629,2.91532 -8.33376,7.70241 6.85535,7.36303 16.1452,5.25935 29.42069,-4.41942 l -1.26269,-0.7576 c -1.39469,6.32146 2.24312,15.21964 14.01587,9.59644;m 184.35284,152.51263 -0.25254,11.99556 c 7.52539,-19.90049 24.69284,-16.78632 27.7792,-13.51079 -9.88482,29.85255 12.2944,22.34205 28.91561,17.29886 5.51409,-2.95038 5.48719,-7.99512 2.27285,-9.97526 -17.26796,11.08414 13.83247,19.08079 27.40038,9.34391 l 0,0 0,0 0,0 0,0;m 164.76913,144.17027 c -0.69555,-0.60895 -1.06147,0.52049 -0.96497,-1.03892 0,0 0.52597,-1.55132 1.91013,0.0829 l -0.49425,1.2698 2.25829,1.75322 0.31568,0.44194".split(";"),c=
0;c<b.length-1;c++)draw_path_slowly(a,b[c],500+400*c,400);draw_path_slowly(a,b[b.length-1],500+400*(b.length-1),150)}function quite_timer(){var a=d3.select("#quite").append("svg").attr("width",320).attr("height",400);d3.timer(function(){if(1080<window.scrollY)return draw_quite_like(a,10),!0});d3.timer(function(){if(1200<window.scrollY)return draw_quite_like(a,140),!0});d3.timer(function(){if(1320<window.scrollY)return draw_quite_like(a,350,!0),!0})}
function draw_quite_like(a,b,c){b=[{x:140,y:b},{x:160,y:b},{x:180,y:b}];a.selectAll("circle").data(b).attr("cy",function(a){return a.y}).attr("cx",function(a){return a.x}).attr("r",5).style("opacity",0).transition().delay(function(a,b){return 500+100*b}).duration(500).style("opacity",1).each("end",function(){c||d3.select(this).transition().delay(function(a,b){return 500+100*b}).duration(500).style("opacity",0)});a.selectAll("circle").data(b).enter().append("circle").attr("cy",function(a){return a.y}).attr("cx",
function(a){return a.x}).attr("r",5).style("opacity",0).transition().delay(function(a,b){return 300+100*b}).duration(300).style("opacity",1).each("end",function(){c||d3.select(this).transition().delay(function(a,b){return 200+100*b}).duration(300).style("opacity",0)})}function like_her_timer(){d3.timer(function(){if(1600<window.scrollY)return draw_like_her(),!0})}
function draw_like_her(){d3.select("#like_her").append("svg").attr("width",320).attr("height",740).selectAll("text").data([{x:50,text:"...and"},{x:90,text:" I "},{x:130,text:"quite"},{x:180,text:" like "},{x:220,text:"her "},{x:260,text:"!"}]).enter().append("text").text(function(a){return a.text}).attr("y",250).attr("x",350).style("font-size","40px").style("text-anchor","middle").attr("dy",".71em").transition().delay(function(a,b){return 100+100*b}).duration(1E3).attr("y",100).attr("x",function(a){return 20+
a.x})}function a_lot_timer(){d3.timer(function(){if(1730<window.scrollY)return draw_a_lot(),!0})}
function draw_a_lot(){d3.selectAll("#like_her text").transition().delay(600).duration(2200).ease("elastic").attr("y",270).attr("x",function(a){return 180>a.x?a.x-22:220==a.x?282:180==a.x?240:302});d3.select("#like_her svg").append("text").text("A LOT").attr("id","LOOOOT").attr("y",650).attr("x",175).style("font-weight","bold").style("font-size","40px").style("text-anchor","middle").attr("dy",".71em").transition().delay(650).duration(2500).ease("elastic").attr("y",270)}
function so_much_timer(){d3.timer(function(){if(1945<window.scrollY)return draw_so_much(),!0})}
function draw_so_much(){d3.select("#like_her svg").append("text").text("So much").attr("id","so_mucho").attr("y",430).attr("x",140).style("font-size","40px").style("text-anchor","middle").attr("dy",".71em").style("opacity",0).transition().delay(500).duration(500).style("opacity",1).each("end",function(){d3.select(this).transition().delay(700).duration(500).style("opacity",0)});d3.select("#like_her svg").append("text").text("...").attr("y",430).attr("x",190).style("font-size","40px").style("text-anchor",
"middle").attr("dy",".71em").style("opacity",0).transition().delay(500).duration(500).style("opacity",1).each("end",function(){d3.select(this).transition().delay(700).duration(500).style("opacity",0)})}function so_much_continue_timer(){d3.timer(function(){if(2214<window.scrollY)return draw_so_much_continue(),!0})}
function draw_so_much_continue(){d3.select("#so_mucho").transition().duration(500).style("opacity",1).attr("y",650).attr("x",160);d3.select("#like_her svg").append("text").text("I wrote her name on").attr("y",680).attr("x",160).style("opacity",0).style("font-size","35px").style("text-anchor","middle").attr("dy",".71em").transition().delay(1100).duration(500).style("opacity",1);d3.select("#like_her svg").append("text").text("all the last pages of my book").attr("y",700).attr("x",160).style("opacity",
0).style("font-size","35px").style("text-anchor","middle").attr("dy",".71em").transition().delay(1600).duration(500).style("opacity",1)}function emoji_start_timer(){d3.timer(function(){if(2335<window.scrollY)return draw_emoji_start(),!0})}
function draw_emoji_start(){function a(){var a=0,a=.5<Math.random()?Math.floor(-20*Math.random()+1):Math.floor(10*Math.random()+320);return{sx:a,sy:Math.floor(550*Math.random()+30),ex:Math.floor(290*Math.random()+40),ey:Math.floor(550*Math.random()+30)}}d3.select("#emoji").append("svg").attr("width",320).attr("height",600).append("text").text("(^ \u25bd ^)").attr("transform","rotate(50)").style("font-size","20px").style("text-anchor","middle").attr("dy",".71em").attr("x",-10).attr("y",250).transition().delay(10).duration(1E3).attr("x",
"160").attr("y","100").attr("transform","rotate(5)");for(var b=0;100>b;b++){var c=a();d3.select("#emoji svg").append("text").text("Prisoner").style("font-size","20px").style("text-anchor","middle").attr("dy",".71em").attr("x",c.sx).attr("y",c.sy).style("opacity",0).transition().delay(function(){return 6E3*Math.random()+1250}).duration(300).style("opacity",.2).style("z-index","-1").attr("x",c.ex).attr("y",c.ey)}}
function emoji_middle_timer(){d3.timer(function(){if(2430<window.scrollY)return draw_emoji_middle(),!0})}function draw_emoji_middle(){d3.select("#emoji svg text").transition().delay(1).duration(500).attr("x","-150").attr("y","290").attr("transform","rotate(-90)")}function emoji_middle2_timer(){d3.timer(function(){if(2537<window.scrollY)return draw_emoji_middle2(),!0})}
function draw_emoji_middle2(){d3.select("#emoji svg text").transition().delay(1).duration(500).attr("x","250").attr("y","-20").attr("transform","rotate(90)")}function emoji_start_smile_timer(){d3.timer(function(){if(2646<window.scrollY)return draw_emoji_start_smile(),!0})}
function draw_emoji_start_smile(){var a=[{y:"514",x:132,t:"."},{y:"514",x:132,t:"."},{y:"510",x:155,t:"\u3002"},{y:"510",x:165,t:"\uff4f"},{y:"505",x:190,t:"\u2661"}];d3.select("#emoji svg text").transition().delay(1).duration(500).text("(\u00b4 \u25bd\uff40)").attr("x","80").attr("y","520").attr("transform","rotate(0)");d3.selectAll("#emoji svg");for(var b in a)d3.select("#emoji svg").append("text").style("font-size","30px").style("text-anchor","middle").attr("id","heart"+b).text(a[b].t).attr("dy",
".71em").attr("x",a[b].x).attr("y",550).style("opacity",0).transition().delay(200+200*b).duration(500).attr("y",a[b].y).style("opacity",1)}function emoji_tabbouleh_timer(){d3.timer(function(){if(2808<window.scrollY)return draw_emoji_tabbouleh(),!0})}
function draw_emoji_tabbouleh(){d3.select("#heart4").transition().delay(1).duration(200).attr("x",210).attr("y",430).style("font-size","190px");d3.select("#emoji svg").append("text").style("font-size","15px").style("text-anchor","middle").attr("id","tabbouleh").text("Tabbouleh").attr("dy",".71em").attr("x",210).attr("y",483).style("opacity",0).transition().delay(240).duration(500).style("opacity",1)}function old_timer(){d3.timer(function(){if(2916<window.scrollY)return draw_older(),!0})}
function draw_older(){d3.select("#old").append("svg").attr("width",320).attr("height",400).selectAll("text").data([{t:"Today",sx:-10,sy:150,ex:70,ey:150,id:"today"},{t:"she's",sx:130,sy:300,ex:130,ey:150,id:"she"},{t:"a bit",sx:190,sy:-10,ex:190,ey:150,id:"bit"},{t:"old",sx:350,sy:150,ex:245,ey:150,id:"old"},{t:"er",sx:350,sy:150,ex:263,ey:150,id:"er"}]).enter().append("text").style("font-size","31px").style("text-anchor","middle").attr("id",function(a){return"old_"+a.id}).text(function(a){return a.t}).attr("dy",
".71em").attr("x",function(a){return a.sx}).attr("y",function(a){return a.sy}).transition().duration(600).attr("x",function(a){return a.ex}).attr("y",function(a){return a.ey})}function old_next_timer(){d3.timer(function(){if(3132<window.scrollY)return draw_older_next(),!0})}
function draw_older_next(){var a=["#old_today","#old_bit","#old_er"],b;for(b in a)d3.select(a[b]).transition().duration(500).style("opacity",0);d3.select("#old_she").transition().duration(700).attr("x",80).attr("y",360);d3.select("#old_old").transition().duration(700).attr("x",140).attr("y",340);d3.select("#old svg").append("text").style("font-size","22px").style("text-anchor","middle").text("NOW  \u30fd\uff08\u00b4\u30fc\uff40\uff09\u250c").attr("dy",".71em").attr("x",500).attr("y",367).transition().delay(400).duration(800).ease("elastic").attr("x",
205)}function happy_timer(){d3.timer(function(){if(3259<window.scrollY)return draw_happy(),!0})}
function draw_happy(){var a=d3.select("#happy").append("svg").attr("width",320).attr("height",300),b=a.append("text").attr("transform","translate(140,120)").attr("dy",".71em").style("font-size","50px").style("text-anchor","middle").text("");letter_by_letter(b,"Happy Birz",100);var b=[{t:"H",x:120,y:205},{t:"E",x:140,y:200},{t:"Y",x:160,y:195},{t:"!",x:180,y:190},{t:"!",x:200,y:185},{t:"!",x:220,y:180}],c;for(c in b)a.append("text").attr("dy",".71em").style("font-size","50px").style("text-anchor",
"middle").attr("transform","rotate(-90)").attr("x",-200).attr("y",390).text(b[c].t).transition().delay(1E3+50*c).duration(250).attr("transform","rotate(-30)").attr("x",b[c].x).attr("y",b[c].y)}
function main(){draw_scroll();dots_timer();once_upon_timer();there_was_timer();her_name_timer();quite_timer();like_her_timer();a_lot_timer();so_much_timer();so_much_continue_timer();emoji_start_timer();emoji_middle_timer();emoji_middle2_timer();emoji_start_smile_timer();emoji_tabbouleh_timer();old_timer();old_next_timer();happy_timer()}window.onload=function(){window.scrollTo(0,0);main()};
